<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image Grid Animation</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
<canvas id="hero_canvas"></canvas>

<script>
const canvas = document.getElementById("hero_canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const gridX = 5;
const gridY = 5;
const duration = 500;

const imageLayers = [];

function animateImageIn(src) {
  const img = new Image();
  img.src = src;

  img.onload = () => {
    const layer = {
      img: img,
      parts: [],
      startTime: null,
      done: false
    };

    const sw = canvas.width / gridX;
    const sh = canvas.height / gridY;

    for (let i = 0; i < gridX; i++) {
      for (let j = 0; j < gridY; j++) {
        layer.parts.push({
          sx: i * img.width / gridX,
          sy: j * img.height / gridY,
          sw: img.width / gridX,
          sh: img.height / gridY,
          dx: i * sw,
          dy: j * sh,
          dw: sw,
          dh: sh,
          scale: 0
        });
      }
    }

    imageLayers.push(layer);
    requestAnimationFrame(drawAllLayers);
  };
}

function drawAllLayers(timestamp) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  let allDone = true;

  for (const layer of imageLayers) {
    if (!layer.startTime) layer.startTime = timestamp;

    const elapsed = timestamp - layer.startTime;
    const progress = Math.min(elapsed / duration, 1);

    for (const part of layer.parts) {
      const scale = progress;
      const dw = part.dw * scale;
      const dh = part.dh * scale;
      const dx = part.dx + (part.dw - dw) / 2;
      const dy = part.dy + (part.dh - dh) / 2;

      ctx.drawImage(
        layer.img,
        part.sx, part.sy, part.sw, part.sh,
        dx, dy, dw, dh
      );
    }

    if (progress < 1) {
      allDone = false;
    } else {
      layer.done = true;
    }
  }

  if (!allDone) {
    requestAnimationFrame(drawAllLayers);
  }
}

// ðŸ” Example usage
animateImageIn("https://fastly.picsum.photos/id/559/1500/900.jpg?hmac=AnvaUqloXUu-0AXQdotNWYlKybMrLldnsTQBFLY4ZDQ");

setTimeout(() => {
    animateImageIn("https://fastly.picsum.photos/id/721/600/300.jpg?hmac=vaqKbGvzEcu_xh8fA2DS5RtxqdKD5D0mKbewOKAs9xE");
}, 2000);

</script>
</body>
</html>
